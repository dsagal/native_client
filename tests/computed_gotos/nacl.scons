# -*- python -*-
# Copyright 2011 The Native Client Authors.  All rights reserved.
# Use of this source code is governed by a BSD-style license that can
# be found in the LICENSE file.

Import('env')

if env.Bit('bitcode'):
  env.Append(LINKFLAGS=['--pnacl-disable-pass=-verify-pnaclabi-module',
                        '--pnacl-disable-pass=-verify-pnaclabi-functions'])
  # TODO(mseaborn): Replace the above with the following option after
  # a TOOL_REVISIONS roll makes the option available:
  #   env.Append(LINKFLAGS=['--pnacl-disable-abi-check'])
  # See https://code.google.com/p/nativeclient/issues/detail?id=2309

# We are testing a GNU C extension which is disallowed by "-pedantic" mode.
env.FilterOut(CCFLAGS=['-pedantic'])

prog = env.ComponentProgram('computed_goto', 'computed_goto.c',
                            EXTRA_LIBS=['${NONIRT_LIBS}'])
node = env.CommandSelLdrTestNacl('computed_goto_test.out', prog)
env.AddNodeToTestSuite(node, ['small_tests'], 'run_computed_goto_test')
